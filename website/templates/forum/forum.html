{% extends "base.html" %} {% block title %}SeroConnect{% endblock %}{% block content%}
<h1>Hi, Welcome back {{user.username}}</h1>

<ul>
  
    {%for post in posts%}
    <li> 
      {% if post.anonymous==False %}
        <h3>{{postuser.query.filter_by(id=post.user_id).first().username }}</h3>
      {%else%}
        <h3>Anonymous</h3>
      {%endif%}

      {% if post.user_id==user.id%}
        <form action="{{ url_for('post.deletepost',postid=post.id) }}" class='deleteform' method="POST">
          <button class='deletebtn' action="submit">Delete {{post.id}}</button>
        </form>
        <form action="{{ url_for('post.editpost',postid=post.id) }}" method="GET">
          <button  id='editbtn' action="submit">Edit</button>
        </form>

    <!-- Image display -->
    <div class="images">
      {% set images=postimage.query.filter(postimage.post_id==post.id).all()%}
      {%if images%}
      {%for image in images %}
        <div class="image-display">
          <img src="{{url_for('static',filename='images/'+image.image)}}" width="200" alt="">
        </div>
      {%endfor%}
      {%endif%}
      
    </div>

    <!-- End image display -->


        <form action="{{url_for('comments.createcomment',postid=post.id,userid=current_user.id)}}" method="POST">
          <div class="form-group">
            <label for="comment">comment</label>
            <textarea id="comment" name="comment" rows="2" cols="30"></textarea>
            <button action="submit">comment</button>
          </div>
          
        </form>
      {% endif %}
        {{post.id}}
        {{post.title}}  
        <br>
        {{post.content}}
        <br>
        <div class="cmt" id="{{post.id}}">View comments
          <div class="comments" >
            {% set comments=postcomment.query.filter(postcomment.post_id==post.id).all()%}
            {%if comments%}
              {%for comment in comments %}
                <div>
                  {{comment.text}}
                  {%if comment.user_id==current_user.id%}
                    <form action="{{ url_for('comments.deletecomment',commentid=comment.id) }}" method="post">
                      <button class='deletecomment' type="submit">Delete</button>
                    </form>
                    <form action="{{ url_for('comments.editcomment',commentid=comment.id) }}" method="get">
                      <button  type="submit">Edit</button>
                    </form>
                  {%endif%}
                  <br>
                </div>
              {%endfor%}
            {%endif%}
          </div>
        </div>
       
      </li>
    {%endfor%}

</ul>
    

<form id='postform' method="POST" enctype="multipart/form-data">
    <h3 align="center">Post</h3>
    <div class="form-group">
      <label for="content">content</label>
      <textarea id="content" name="content" rows="4" cols="50"></textarea>
    </div>
    <div class="form-group">
      <label for="Title">Title</label>
      <input type="text" class="form-control" id="Title" name="Title" placeholder="Enter Title"
      />
    </div>
    <p><input type="file" name="file" multiple accept=".jpg, .png, .gif,.jpeg"></p>
    <br/>
    <button type="submit" id='btn1' class="btn btn-primary">Submit</button>
    <button type="submit" id='btn2' class="btn btn-primary">Post anonymous</button>
</form>


{% endblock %}

